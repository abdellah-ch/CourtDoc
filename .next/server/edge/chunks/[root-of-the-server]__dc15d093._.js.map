{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { jwtVerify } from 'jose';\r\n\r\nconst SECRET = new TextEncoder().encode(process.env.JWT_SECRET);\r\n\r\nexport async function middleware(req: NextRequest) {\r\n\r\n  console.log(req.url);\r\n  \r\n\r\n  const token = req.cookies.get('session')?.value;\r\n\r\n  if (!token) {\r\n    console.log('No token found, redirecting to login');\r\n    return NextResponse.redirect(new URL('/login', req.url));\r\n  }\r\n\r\n  try {\r\n    // Verify the JWT using `jose`\r\n    const { payload } = await jwtVerify(token, SECRET);\r\n    console.log('Token verified:', payload);\r\n    //regular user\r\n    if(payload.role === 3) {\r\n      if(req.url.includes('/admin')) {\r\n        console.log('User is not admin, redirecting to dashboard');\r\n        return NextResponse.redirect(new URL('/dashboard', req.url));\r\n      }\r\n    } else {\r\n      console.log('User is admin, allowing access to admin route');\r\n    }\r\n    //regular user\r\n    \r\n    // Allow the request to proceed\r\n    return NextResponse.next();\r\n  } catch (err) {\r\n    console.error('JWT verification failed:', err);\r\n    return NextResponse.redirect(new URL('/login', req.url));\r\n  }\r\n}\r\n\r\nexport const config = {\r\n  matcher: ['/dashboard/:path*', '/admin/:path*'], // Protect these routes\r\n};"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEA,MAAM,SAAS,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,UAAU;AAEvD,eAAe,WAAW,GAAgB;IAE/C,QAAQ,GAAG,CAAC,IAAI,GAAG;IAGnB,MAAM,QAAQ,IAAI,OAAO,CAAC,GAAG,CAAC,YAAY;IAE1C,IAAI,CAAC,OAAO;QACV,QAAQ,GAAG,CAAC;QACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,IAAI,GAAG;IACxD;IAEA,IAAI;QACF,8BAA8B;QAC9B,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,CAAA,GAAA,+JAAA,CAAA,YAAS,AAAD,EAAE,OAAO;QAC3C,QAAQ,GAAG,CAAC,mBAAmB;QAC/B,cAAc;QACd,IAAG,QAAQ,IAAI,KAAK,GAAG;YACrB,IAAG,IAAI,GAAG,CAAC,QAAQ,CAAC,WAAW;gBAC7B,QAAQ,GAAG,CAAC;gBACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc,IAAI,GAAG;YAC5D;QACF,OAAO;YACL,QAAQ,GAAG,CAAC;QACd;QACA,cAAc;QAEd,+BAA+B;QAC/B,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;IAC1B,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,IAAI,GAAG;IACxD;AACF;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;QAAqB;KAAgB;AACjD"}}]
}